# Remote Procedure Calls (RPC)
---
[Go Back](../README.md)

---
## Local Calls vs. Remote Calls
- **Local calls**
	- One single process
	- Can pass args by reference
- **Remote calls**
	- Two processes (Caller and called).
	- Requires to locate the remote machine.
	- Requires to check types existence (and coherence).
	- Cannot pass arguments by reference.
---
## Stubs
- Are the functions for interaction at the message level.
- **Client stub**: Sends parameters and waits for the response.
- **Server stub**: Waits for connection, reads message, invokes function, and sends result.
---
## RPC Implementation (XDR)
- Both client and server will implement `myProgram.h` generated with `rpcgen`
- Client will be compiled with `myProgram_clnt.c`
- Server will be compiled with `myProgram_srv.c`
```C
// File: myProgram.x
struct MyParams
{
	int a;
	int b;
};
typedef int MyReturn;

program MY_PROGRAM
{
	version BETA 
	{
		MyReturn myFunction(MyParams params) = 1; // ID = 1
		MyReturn myOtherFunction(MyParams params) = 2; // ID = 2
	}
	= 17; // Version ID for BETA
}
= 0x40008001; // Server ID for MY_PROGRAM
```

```C
// File: server.c
#include "myProgram.h"

// Defines the function (args and return by reference to static variable)
// Always receives struct svc_req pointer
MyReturn *myFunction_17_srv(MyParams *params, struct svc_req *r)
{
	static MyReturn result; // Create static variable to return
	result = data−>a + data−>b; // Calculation
	return (&result); // Return result as pointer
}
```

```C
// File: client.c
#include "myProgram.h"

CLIENT *clnt; // Some variables
MyReturn *result;
MyParams params;

// Create the server conection
clnt = clnt_create("my.server.com", CALCULATION_SERVER, BETA, "udp");
if (clnt == NULL) exit(EXIT_ERROR)

op.a = 5; // Set the args
op.b = 7;
res = myFunction_17(&op, clnt);

clnt_destroy(clnt);
```

**Asynchronous RPCs:**
- Allows the client to continue working without waiting for the response.

**Problems and Solutions in ONC RPC:**
- **Parameter coding**: Using XDR.
- **Interface specification**: Using IDL.
- **Service location**: Using portmapper.
- **Code generation**: Using rpcgen.

**Interface Specification:**
- Specified in a specific language (.x file), declaring parameters, result types, and services offered by RPC.

**Java RMI (Remote Method Invocation):**
- Object-oriented equivalent of RPC.
- Remote classes implement methods, with stubs and skeletons handling communication.
- Requires a registry for client-server connection.

This document provides detailed examples and pseudocode for implementing and understanding RPC and Java RMI in distributed systems.